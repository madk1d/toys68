var snowStorm=null;function SnowStorm(){var imagePath=sitePath+"snow/",flakesMax=sflakesMax||64,flakesMaxActive=sflakesMaxActive||64,vMaxX=svMaxX||2,vMaxY=svMaxY||3,usePNG=!0,flakeBottom=null,snowStick=!!ssnowStick,snowCollect=!1,targetElement=null,followMouse=!!sfollowMouse,flakeTypes=5,flakeWidth=15,flakeHeight=15,zIndex=999,flakeLeftOffset=0,flakeRightOffset=0,addEvent=function(e,t,s){"undefined"==typeof attachEvent?e.addEventListener(t,s,!1):e.attachEvent("on"+t,s)},removeEvent=function(e,t,s){"undefined"==typeof attachEvent?e.removeEventListener(t,s,!1):e.detachEvent("on"+t,s)},classContains=function(e,t){return void 0!==e.className&&e.className.indexOf(t)+1},s=this,storm=this;this.timers=[],this.flakes=[],this.disabled=!1,this.terrain=[],this.active=!1;var isIE=navigator.userAgent.match(/msie/i),isIE6=navigator.userAgent.match(/msie 6/i),isOldIE=isIE&&(isIE6||navigator.userAgent.match(/msie 5/i)),isWin9X=navigator.appVersion.match(/windows 98/i),isiPhone=navigator.userAgent.match(/iphone/i),isBackCompatIE=isIE&&"BackCompat"==document.compatMode,isOpera=navigator.userAgent.match(/opera/i);isOpera&&(isIE=!1);var noFixed=isBackCompatIE||isIE6||isiPhone,screenX=null,screenX2=null,screenY=null,scrollY=null,vRndX=null,vRndY=null,windOffset=1,windMultiplier=2,pngSupported=!isIE||isIE&&!isIE6&&!isOldIE,docFrag=document.createDocumentFragment();function rnd(e,t){return isNaN(t)&&(t=0),Math.random()*e+t}function plusMinus(e){return 1==parseInt(rnd(2))?-1*e:e}this.oControl=null,null==flakeLeftOffset&&(flakeLeftOffset=0),null==flakeRightOffset&&(flakeRightOffset=0),this.randomizeWind=function(){if(vRndX=plusMinus(rnd(vMaxX,.2)),vRndY=rnd(vMaxY,.2),this.flakes)for(var e=0;e<this.flakes.length;e++)this.flakes[e].active&&this.flakes[e].setVelocities()},this.scrollHandler=function(){if(scrollY=flakeBottom?0:parseInt(window.scrollY||document.documentElement.scrollTop||document.body.scrollTop),isNaN(scrollY)&&(scrollY=0),!flakeBottom&&s.flakes)for(var e=0;e<s.flakes.length;e++)0==s.flakes[e].active&&s.flakes[e].stick()},this.resizeHandler=function(){window.innerWidth||window.innerHeight?(screenX=window.innerWidth-(isIE?2:16)-flakeRightOffset,screenY=flakeBottom||window.innerHeight):(screenX=(document.documentElement.clientWidth||document.body.clientWidth||document.body.scrollWidth)-(isIE?0:8)-flakeRightOffset,screenY=flakeBottom||(document.documentElement.clientHeight||document.body.clientHeight||document.body.scrollHeight)),screenX2=parseInt(screenX/2)},this.resizeHandlerAlt=function(){screenX=targetElement.offsetLeft+targetElement.offsetWidth-flakeRightOffset,screenY=flakeBottom||targetElement.offsetTop+targetElement.offsetHeight,screenX2=parseInt(screenX/2)},this.freeze=function(){if(s.disabled)return!1;s.disabled=1;for(var e=0;e<s.timers.length;e++)clearInterval(s.timers[e])},this.resume=function(){if(!s.disabled)return!1;s.disabled=0,s.timerInit()},this.toggleSnow=function(){s.flakes.length?(s.active=!s.active,s.active?(s.show(),s.resume(),s.setControlActive(!0)):(s.stop(),s.freeze(),s.setControlActive(!1))):(s.start(),s.setControlActive(!0))},this.stop=function(){this.freeze();for(var e=this.flakes.length;e--;)this.flakes[e].o.style.display="none";removeEvent(window,"scroll",s.scrollHandler),removeEvent(window,"resize",s.resizeHandler),isIE||(removeEvent(window,"blur",s.freeze),removeEvent(window,"focus",s.resume))},this.show=function(){for(var e=this.flakes.length;e--;)this.flakes[e].o.style.display="block"},this.SnowFlake=function(e,t,s,n){var i=this,o=e;this.type=t,this.x=s||parseInt(rnd(screenX-20)),this.y=isNaN(n)?-rnd(screenY)-12:n,this.vX=null,this.vY=null,this.vAmpTypes=[2,1,1.25,1,1.5,1.75],this.vAmp=this.vAmpTypes[this.type],this.active=1,this.o=document.createElement("img"),this.o.style.position="absolute",this.o.style.width=flakeWidth+"px",this.o.style.height=flakeHeight+"px",this.o.style.fontSize="1px",this.o.style.zIndex=zIndex,this.o.src=imagePath+this.type+(pngSupported&&usePNG?".png":".gif"),docFrag.appendChild(this.o),this.refresh=function(){i.o.style.left=i.x+"px",i.o.style.top=i.y+"px"},this.stick=function(){noFixed||targetElement!=document.documentElement&&targetElement!=document.body?i.o.style.top=screenY+scrollY-flakeHeight-o.terrain[Math.floor(i.x)]+"px":(i.o.style.display="none",i.o.style.top="auto",i.o.style.bottom="0px",i.o.style.position="fixed",i.o.style.display="block")},this.vCheck=function(){0<=i.vX&&i.vX<.2?i.vX=.2:i.vX<0&&-.2<i.vX&&(i.vX=-.2),0<=i.vY&&i.vY<.2&&(i.vY=.2)},this.move=function(){var e=i.vX*windOffset;if(i.x+=e,i.y+=i.vY*i.vAmp,0<=e&&(i.x>=screenX||screenX-i.x<flakeWidth+1)?i.x=0:e<0&&i.x-flakeLeftOffset<0-flakeWidth&&(i.x=screenX-flakeWidth-1),i.refresh(),screenY+scrollY-i.y-o.terrain[Math.floor(i.x)]<flakeHeight){if(i.active=0,snowCollect&&snowStick)for(var t=[.75,1.5,.75],s=0;s<2;s++)o.terrain[Math.floor(i.x)+s+2]+=t[s];i.o.style.left=i.x/screenX*100+"%",flakeBottom||(snowStick?i.stick():i.recycle())}},this.animate=function(){i.move()},this.setVelocities=function(){i.vX=vRndX+rnd(.12*vMaxX,.1),i.vY=vRndY+rnd(.12*vMaxY,.1)},this.recycle=function(){i.o.style.display="none",i.o.style.position="absolute",i.o.style.bottom="auto",i.setVelocities(),i.vCheck(),i.x=parseInt(rnd(screenX-flakeWidth-20)),i.y=parseInt(-1*rnd(screenY))-flakeHeight,i.o.style.left=i.x+"px",i.o.style.top=i.y+"px",i.o.style.display="block",i.active=1},this.recycle(),this.refresh()},this.snow=function(){for(var active=0,used=0,waiting=0,i=s.flakes.length;i--;)1==s.flakes[i].active?(s.flakes[i].move(),active++):0==s.flakes[i].active?used++:waiting++;if(snowCollect&&!waiting&&s.createSnow(flakesMaxActive,!0),active<flakesMaxActive)with(s.flakes[parseInt(rnd(s.flakes.length))])snowCollect||0!=active?-1==active&&(active=1):recycle()},this.mouseMove=function(e){if(!followMouse)return!0;var t=parseInt(e.clientX);windOffset=t<screenX2?t/screenX2*windMultiplier-windMultiplier:(t-=screenX2)/screenX2*windMultiplier},this.createSnow=function(e,t){for(var n=0;n<e;n++)s.flakes[s.flakes.length]=new s.SnowFlake(s,parseInt(rnd(flakeTypes))),(t||flakesMaxActive<n)&&(s.flakes[s.flakes.length-1].active=-1);targetElement.appendChild(docFrag)},this.timerInit=function(){s.timers=isWin9X?[setInterval(s.snow,75),setInterval(s.snow,25)]:[setInterval(s.snow,20)]},this.init=function(){for(var e=0;e<2048;e++)s.terrain[e]=0;s.randomizeWind(),s.createSnow(snowCollect?flakesMaxActive:2*flakesMaxActive),addEvent(window,"resize",s.resizeHandler),addEvent(window,"scroll",s.scrollHandler),isIE||(addEvent(window,"blur",s.freeze),addEvent(window,"focus",s.resume)),s.resizeHandler(),s.scrollHandler(),followMouse&&addEvent(document,"mousemove",s.mouseMove),s.timerInit()};var didInit=!1;this.start=function(e){if(didInit){if(e)return!0}else didInit=!0;if("string"==typeof targetElement&&!(targetElement=document.getElementById(targetElement)))throw new Error("Snowstorm: Unable to get targetElement");targetElement||(targetElement=isIE?document.body:document.documentElement?document.documentElement:document.body),targetElement!=document.documentElement&&targetElement!=document.body&&(s.resizeHandler=s.resizeHandlerAlt),s.resizeHandler(),screenX&&screenY&&!s.disabled&&(s.init(),s.active=!0)},document.addEventListener?(document.addEventListener("DOMContentLoaded",function(){s.start(!0)},!1),window.addEventListener("load",function(){s.start(!0)},!1)):addEvent(window,"load",function(){s.start(!0)})}snowStorm=new SnowStorm;